<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.plz.config.mybatis.mapper.careMapper">
	
	<!-- 
		care를 insert를 하기 전에 care의 VO안에 careI생성되어 미리 들어 간다.
	 -->
	<insert id="insertCare" parameterType="Care">
 		<selectKey keyProperty="careId" resultType="_int" order="BEFORE">
			select care_id_seq.nextval from dual
		</selectKey>
		insert into care values(#{careId}, #{careContents}, #{resId}, #{careDate})
	</insert>
	
	<resultMap type="care" id="care-resultmap">
		<id column="care_id" property="careId"/>
		<result column="care_contents" property="careContents"/>
		<result column="res_id" property="resId"/>
		<result column="care_date" property="careDate"/>
	</resultMap>
	
	<resultMap type="care" id="care-join-care_image-resultmap" extends="care-resultmap">
		<collection property="careImageList" ofType="CareImage">
			<id column="care_image" property="imageName"/>
			<result column="care_id" property="careId"/>
		</collection>
	</resultMap>
	
	<select id="selectCareJoinCareImage" parameterType="_int" resultMap="care-join-care_image-resultmap">
		select	c.care_id, c.care_contents, c.res_id, c.care_date, i.care_image
		from	care c, care_image i
		where	c.res_id = #{value} and c.care_id = i.care_id(+)
	</select>
	
	<update id="updateCare" parameterType="Care">
		update	care
		set		care_contents = #{careContents},
				res_id = #{resId},
				care_date = #{careDate}
		where	care_id = #{careId}
	</update>
	
	<delete id="deleteCare" parameterType="_int">
		delete from care where care_id = #{value}
	</delete>
	
	<!-- 이미지 관리 -->
	<insert id="insertCareImage" parameterType="CareImage">
		insert into care_image values(#{imageName}, #{careId})
	</insert>
	
	<update id="updateCareImage" parameterType="map">
		update care_image set care_image = #{imageName} where care_id = #{careId} and care_image = #{originalImage}
	</update>
	
	<delete id="deleteCareImage" parameterType="string">
		delete from care_image where care_image = #{value}
	</delete>
</mapper>